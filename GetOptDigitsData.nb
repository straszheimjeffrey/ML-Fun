(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     15720,        504]
NotebookOptionsPosition[     13894,        451]
NotebookOutlinePosition[     14554,        473]
CellTagsIndexPosition[     14511,        470]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetDirectory", "[", "\"\<~/Math/ML-Fun\>\"", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "ML`"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getdata", "[", "filename_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "data", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"filename", ",", "String"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"data", ",", 
        RowBox[{"LengthWhile", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringLength", "[", "#", "]"}], "\[NotEqual]", "32"}], 
            ")"}], "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"data", ",", "33"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", "i", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"image", ",", "digit"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"image", "=", 
             RowBox[{"Take", "[", 
              RowBox[{"i", ",", "32"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"digit", "=", 
             RowBox[{
              RowBox[{"Last", "[", "i", "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"image", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Characters", "/@", "image"}], "//", "Flatten"}], "//", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#", "\[Equal]", "\"\<1\>\""}], ",", "1", ",", 
                    "0"}], "]"}], "&"}], ",", "#"}], "]"}], "&"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"digit", ",", "image"}], "}"}]}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "data"}], "]"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trainingdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.tra\>\"", "]"}]}]}], 
    "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"validationdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.cv\>\"", "]"}]}]}], "]"}]}],
   ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "[", "x_", "]"}], ":=", 
  RowBox[{"Image", "[", 
   RowBox[{"Partition", "[", 
    RowBox[{"x", ",", "32"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "/@", 
   RowBox[{"GetVec", "/@", 
    RowBox[{"Take", "[", 
     RowBox[{"trainingdata", ",", "10"}], "]"}]}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"toimage", "[", 
     RowBox[{"Mean", "[", 
      RowBox[{"ClassMatrix", "[", 
       RowBox[{"trainingdata", ",", "c"}], "]"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", "0", ",", "9"}], "}"}]}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fullmean", "=", 
   RowBox[{"Mean", "[", 
    RowBox[{"FullMatrix", "[", "trainingdata", "]"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"datatranslated", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{
     RowBox[{"x", "\[Function]", 
      RowBox[{"x", "-", "fullmean"}]}], ",", "trainingdata"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"nozeros", ",", "zeromat"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"RemoveZeros", "[", "datatranslated", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", 
      RowBox[{"{", 
       RowBox[{"newdata", ",", "mat", ",", "evals"}], "}"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{"MakeLDA", "[", "nozeros", "]"}], "//", "AbsoluteTiming"}]}], 
   ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"newdata", ",", "mat", ",", "vals"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"MakePCA", "[", 
     RowBox[{"nozeros", ",", "40"}], "]"}], "//", "AbsoluteTiming"}]}], ";", 
  "t"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "normal"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MultiVariateNormalClassifier", "[", "newdata", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "normal"}], "}"}], "=", 
    RowBox[{
     RowBox[{
     "MultiVariateNormalClassifierSingleCovariance", "[", "newdata", "]"}], "//",
      "AbsoluteTiming"}]}], ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cmat", "=", 
   RowBox[{"mat", ".", "zeromat"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normguess", "[", "i_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "converted", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"converted", ":=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"i", "-", "fullmean"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normal", "[", "converted", "]"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "results"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MapVecs", "[", 
     RowBox[{"normguess", ",", "validationdata"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"errorcount", "=", 
  RowBox[{"Apply", "[", 
   RowBox[{"Plus", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
      ")"}], "/@", "results"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"Length", "[", "results", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"1.0", "-", 
  RowBox[{"N", "[", 
   RowBox[{"errorcount", "/", 
    RowBox[{"Length", "[", "results", "]"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Range", "[", 
    RowBox[{"0", ",", "9"}], "]"}], "/.", 
   RowBox[{"GatherData", "[", "results", "]"}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "res_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Reap", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"GetVec", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[Equal]", 
          RowBox[{"GetClass", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
         RowBox[{"Sow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"GetVec", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"GetClass", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"toimage", "[", 
             RowBox[{"GetVec", "[", 
              RowBox[{"validationdata", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], "}"}], "]"}]}],
         "]"}]}], ")"}], "\[IndentingNewLine]", "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "res", "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "results", "]"}], "//", "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mattransversed", "=", 
   SuperscriptBox["mat", "\[Transpose]"]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unzeromat", "=", 
   RowBox[{"PseudoInverse", "[", "zeromat", "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uncmat", "=", 
   RowBox[{"unzeromat", ".", "mattransversed"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"eigenproject", "[", "x_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vec", ",", "converted", ",", "restored"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vec", "=", 
      RowBox[{"GetVec", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"converted", "=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"vec", "-", "fullmean"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"restored", "=", 
      RowBox[{
       RowBox[{"uncmat", ".", "converted"}], "+", "fullmean"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"toimage", "[", "vec", "]"}], ",", 
       RowBox[{"toimage", "[", "restored", "]"}]}], "}"}]}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"eigenproject", "/@", 
  RowBox[{"Take", "[", 
   RowBox[{"trainingdata", ",", "32"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Partition", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"vals", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"toimage", "[", 
          RowBox[{
           RowBox[{"unzeromat", ".", 
            RowBox[{"mat", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "+", "fullmean"}], "]"}]}], 
        "}"}]}], ")"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "mat", "]"}], "]"}]}], ",", "8"}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "decisiontree"}], "}"}], "=", 
    RowBox[{
     RowBox[{"MakeTree", "[", 
      RowBox[{"newdata", ",", ".01"}], "]"}], "//", "AbsoluteTiming"}]}], ";",
    "t"}], "*)"}]], "Input",
 CellChangeTimes->{{3.547927569664506*^9, 3.5479275830832863`*^9}, {
   3.5479276147382603`*^9, 3.547927659480291*^9}, 3.547936580707494*^9, {
   3.547936643680984*^9, 3.54793665139822*^9}, 3.547937485462233*^9, 
   3.547937656195476*^9, {3.54793774999831*^9, 3.54793775704539*^9}, {
   3.547937927152376*^9, 3.54793792903939*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "results2"}], "}"}], "=", 
    RowBox[{
     RowBox[{"MapVecs", "[", 
      RowBox[{
       RowBox[{"x", "\[Function]", 
        RowBox[{"TreeClassify", "[", 
         RowBox[{"decisiontree", ",", 
          RowBox[{"cmat", ".", 
           RowBox[{"(", 
            RowBox[{"x", "-", "fullmean"}], ")"}]}]}], "]"}]}], ",", 
       "validationdata"}], "]"}], "//", "AbsoluteTiming"}]}], ";", "t"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.547936145755105*^9, 3.547936235753582*^9}, {
   3.547936270137041*^9, 3.547936393870215*^9}, {3.547936530541641*^9, 
   3.54793656939415*^9}, {3.547936790258712*^9, 3.5479368021206408`*^9}, {
   3.547936955679874*^9, 3.547936975588345*^9}, 3.547937006116149*^9, 
   3.547937482574957*^9, 3.5479376580565023`*^9, {3.547937932777546*^9, 
   3.547937936830757*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"errorcount2", "=", 
   RowBox[{"Apply", "[", 
    RowBox[{"Plus", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"s", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           RowBox[{"s", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
       ")"}], "/@", "results2"}]}], "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.5479377041126223`*^9, 3.547937706277767*^9}, {
  3.547937939128084*^9, 3.547937940671664*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"showerrors", "[", "results2", "]"}], "//", "TableForm"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.547937724694476*^9, 3.54793772966098*^9}, {
  3.547937943056025*^9, 3.547937945358563*^9}}]
},
WindowSize->{851, 740},
WindowMargins->{{8, Automatic}, {Automatic, 0}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, \
2011)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]]}, WindowSize -> {740, 652}, 
  WindowMargins -> {{Automatic, 216}, {16, Automatic}}, Visible -> False, 
  FrontEndVersion -> 
  "8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, 2011)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 85, 1, 27, "Input"],
Cell[645, 23, 47, 1, 27, "Input"],
Cell[695, 26, 2226, 57, 193, "Input"],
Cell[2924, 85, 503, 15, 27, "Input"],
Cell[3430, 102, 502, 15, 27, "Input"],
Cell[3935, 119, 180, 5, 27, "Input"],
Cell[4118, 126, 192, 6, 27, "Input"],
Cell[4313, 134, 329, 10, 27, "Input"],
Cell[4645, 146, 156, 4, 27, "Input"],
Cell[4804, 152, 224, 7, 27, "Input"],
Cell[5031, 161, 282, 9, 27, "Input"],
Cell[5316, 172, 312, 10, 27, "Input"],
Cell[5631, 184, 305, 10, 27, "Input"],
Cell[5939, 196, 232, 7, 27, "Input"],
Cell[6174, 205, 285, 9, 27, "Input"],
Cell[6462, 216, 102, 3, 27, "Input"],
Cell[6567, 221, 444, 11, 73, "Input"],
Cell[7014, 234, 253, 8, 27, "Input"],
Cell[7270, 244, 465, 14, 27, "Input"],
Cell[7738, 260, 65, 1, 27, "Input"],
Cell[7806, 263, 153, 4, 27, "Input"],
Cell[7962, 269, 187, 6, 27, "Input"],
Cell[8152, 277, 1285, 34, 88, "Input"],
Cell[9440, 313, 101, 2, 27, "Input"],
Cell[9544, 317, 118, 3, 31, "Input"],
Cell[9665, 322, 122, 3, 27, "Input"],
Cell[9790, 327, 117, 3, 27, "Input"],
Cell[9910, 332, 849, 24, 103, "Input"],
Cell[10762, 358, 128, 3, 27, "Input"],
Cell[10893, 363, 612, 19, 43, "Input"],
Cell[11508, 384, 608, 14, 27, "Input"],
Cell[12119, 400, 898, 22, 43, "Input"],
Cell[13020, 424, 622, 17, 27, "Input"],
Cell[13645, 443, 245, 6, 27, "Input"]
}
]
*)

(* End of internal cache information *)
