(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     16180,        532]
NotebookOptionsPosition[     14165,        472]
NotebookOutlinePosition[     14825,        494]
CellTagsIndexPosition[     14782,        491]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetDirectory", "[", "\"\<~/Math/ML-Fun\>\"", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "ML`"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getdata", "[", "filename_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "data", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"filename", ",", "String"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"data", ",", 
        RowBox[{"LengthWhile", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringLength", "[", "#", "]"}], "\[NotEqual]", "32"}], 
            ")"}], "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"data", ",", "33"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", "i", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"image", ",", "digit"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"image", "=", 
             RowBox[{"Take", "[", 
              RowBox[{"i", ",", "32"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"digit", "=", 
             RowBox[{
              RowBox[{"Last", "[", "i", "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"image", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Characters", "/@", "image"}], "//", "Flatten"}], "//", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Boole", "[", 
                   RowBox[{"#", "\[Equal]", "\"\<1\>\""}], "]"}], "&"}], ",", 
                 "#"}], "]"}], "&"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"digit", "\[Equal]", "0"}], ",", "10", ",", "digit"}],
                "]"}], ",", "image"}], "}"}]}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "data"}], "]"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"trainingdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.tra\>\"", "]"}]}]}], 
    "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"validationdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.cv\>\"", "]"}]}]}], "]"}]}],
   ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "[", "x_", "]"}], ":=", 
  RowBox[{"Image", "[", 
   RowBox[{"Partition", "[", 
    RowBox[{"x", ",", "32"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "/@", 
   RowBox[{"GetVec", "/@", 
    RowBox[{"Take", "[", 
     RowBox[{"trainingdata", ",", "10"}], "]"}]}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"toimage", "[", 
     RowBox[{"Mean", "[", 
      RowBox[{"ClassMatrix", "[", 
       RowBox[{"trainingdata", ",", "c"}], "]"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", "0", ",", "9"}], "}"}]}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fullmean", "=", 
   RowBox[{"Mean", "[", 
    RowBox[{"FullMatrix", "[", "trainingdata", "]"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"datatranslated", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{
     RowBox[{"x", "\[Function]", 
      RowBox[{"x", "-", "fullmean"}]}], ",", "trainingdata"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"nozeros", ",", "zeromat"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"RemoveZeros", "[", "datatranslated", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", 
      RowBox[{"{", 
       RowBox[{"newdata", ",", "mat", ",", "evals"}], "}"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{"MakeLDA", "[", "nozeros", "]"}], "//", "AbsoluteTiming"}]}], 
   ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"newdata", ",", "mat", ",", "vals"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"MakePCA", "[", 
     RowBox[{"nozeros", ",", "40"}], "]"}], "//", "AbsoluteTiming"}]}], ";", 
  "t"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "normal"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MultiVariateNormalClassifier", "[", "newdata", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "normal"}], "}"}], "=", 
    RowBox[{
     RowBox[{
     "MultiVariateNormalClassifierSingleCovariance", "[", "newdata", "]"}], "//",
      "AbsoluteTiming"}]}], ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cmat", "=", 
   RowBox[{"mat", ".", "zeromat"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"normguess", "[", "i_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "converted", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"converted", ":=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"i", "-", "fullmean"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normal", "[", "converted", "]"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "results"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MapVecs", "[", 
     RowBox[{"normguess", ",", "validationdata"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"errorcount", "=", 
  RowBox[{"Apply", "[", 
   RowBox[{"Plus", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
      ")"}], "/@", "results"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"Length", "[", "results", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"1.0", "-", 
  RowBox[{"N", "[", 
   RowBox[{"errorcount", "/", 
    RowBox[{"Length", "[", "results", "]"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Range", "[", 
    RowBox[{"0", ",", "9"}], "]"}], "/.", 
   RowBox[{"GatherData", "[", "results", "]"}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "res_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Reap", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"GetVec", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[Equal]", 
          RowBox[{"GetClass", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Sow", "[", 
          RowBox[{"Labeled", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"GetVec", "[", 
               RowBox[{"res", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
              RowBox[{"GetClass", "[", 
               RowBox[{"res", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Framed", "[", 
             RowBox[{"toimage", "[", 
              RowBox[{"GetVec", "[", 
               RowBox[{"validationdata", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], "]"}]}], "]"}], 
          "]"}]}], "]"}]}], ")"}], "\[IndentingNewLine]", "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "res", "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.54797493570828*^9, 3.5479749936025963`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "results", "]"}], "//", "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mattransversed", "=", 
   SuperscriptBox["mat", "\[Transpose]"]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unzeromat", "=", 
   RowBox[{"PseudoInverse", "[", "zeromat", "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uncmat", "=", 
   RowBox[{"unzeromat", ".", "mattransversed"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"eigenproject", "[", "x_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vec", ",", "converted", ",", "restored"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vec", "=", 
      RowBox[{"GetVec", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"converted", "=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"vec", "-", "fullmean"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"restored", "=", 
      RowBox[{
       RowBox[{"uncmat", ".", "converted"}], "+", "fullmean"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"toimage", "[", "vec", "]"}], ",", 
       RowBox[{"toimage", "[", "restored", "]"}]}], "}"}]}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"eigenproject", "/@", 
  RowBox[{"Take", "[", 
   RowBox[{"trainingdata", ",", "32"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Partition", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"vals", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"toimage", "[", 
          RowBox[{
           RowBox[{"unzeromat", ".", 
            RowBox[{"mat", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "+", "fullmean"}], "]"}]}], 
        "}"}]}], ")"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "mat", "]"}], "]"}]}], ",", "8"}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"LaunchKernels", "[", "]"}]], "Input",
 CellChangeTimes->{{3.547974620791856*^9, 3.54797462355434*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"KernelObject", "[", 
    RowBox[{"1", ",", "\<\"local\"\>"}], "]"}], ",", 
   RowBox[{"KernelObject", "[", 
    RowBox[{"2", ",", "\<\"local\"\>"}], "]"}], ",", 
   RowBox[{"KernelObject", "[", 
    RowBox[{"3", ",", "\<\"local\"\>"}], "]"}], ",", 
   RowBox[{"KernelObject", "[", 
    RowBox[{"4", ",", "\<\"local\"\>"}], "]"}]}], "}"}]], "Output",
 CellChangeTimes->{3.547974625649835*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "decisiontree"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MakeTree", "[", 
     RowBox[{
      RowBox[{"Take", "[", 
       RowBox[{"newdata", ",", "500"}], "]"}], ",", ".75"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input",
 CellChangeTimes->{{3.54797450244615*^9, 3.547974504174017*^9}}],

Cell[BoxData["33.926614`7.9820855111282745"], "Output",
 CellChangeTimes->{3.54797453907191*^9, 3.5479745917327757`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "results2"}], "}"}], "=", 
    RowBox[{
     RowBox[{"MapVecs", "[", 
      RowBox[{
       RowBox[{"x", "\[Function]", 
        RowBox[{"TreeClassify", "[", 
         RowBox[{"decisiontree", ",", 
          RowBox[{"cmat", ".", 
           RowBox[{"(", 
            RowBox[{"x", "-", "fullmean"}], ")"}]}]}], "]"}]}], ",", 
       "validationdata"}], "]"}], "//", "AbsoluteTiming"}]}], ";", "t"}], 
  "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"errorcount2", "=", 
   RowBox[{"Apply", "[", 
    RowBox[{"Plus", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"s", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           RowBox[{"s", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
       ")"}], "/@", "results2"}]}], "]"}]}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"showerrors", "[", "results2", "]"}], "//", "TableForm"}], 
  "*)"}]], "Input"]
},
WindowSize->{851, 740},
WindowMargins->{{8, Automatic}, {Automatic, 0}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, \
2011)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]]}, WindowSize -> {740, 652}, 
  WindowMargins -> {{Automatic, 216}, {16, Automatic}}, Visible -> False, 
  FrontEndVersion -> 
  "8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, 2011)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 85, 1, 27, "Input"],
Cell[645, 23, 47, 1, 27, "Input"],
Cell[695, 26, 2314, 59, 193, "Input"],
Cell[3012, 87, 503, 15, 27, "Input"],
Cell[3518, 104, 502, 15, 27, "Input"],
Cell[4023, 121, 180, 5, 27, "Input"],
Cell[4206, 128, 192, 6, 27, "Input"],
Cell[4401, 136, 329, 10, 27, "Input"],
Cell[4733, 148, 156, 4, 27, "Input"],
Cell[4892, 154, 224, 7, 27, "Input"],
Cell[5119, 163, 282, 9, 27, "Input"],
Cell[5404, 174, 312, 10, 27, "Input"],
Cell[5719, 186, 305, 10, 27, "Input"],
Cell[6027, 198, 232, 7, 27, "Input"],
Cell[6262, 207, 285, 9, 27, "Input"],
Cell[6550, 218, 102, 3, 27, "Input"],
Cell[6655, 223, 444, 11, 73, "Input"],
Cell[7102, 236, 253, 8, 27, "Input"],
Cell[7358, 246, 465, 14, 27, "Input"],
Cell[7826, 262, 65, 1, 27, "Input"],
Cell[7894, 265, 153, 4, 27, "Input"],
Cell[8050, 271, 187, 6, 27, "Input"],
Cell[8240, 279, 1550, 40, 88, "Input"],
Cell[9793, 321, 101, 2, 27, "Input"],
Cell[9897, 325, 118, 3, 31, "Input"],
Cell[10018, 330, 122, 3, 27, "Input"],
Cell[10143, 335, 117, 3, 27, "Input"],
Cell[10263, 340, 849, 24, 103, "Input"],
Cell[11115, 366, 128, 3, 27, "Input"],
Cell[11246, 371, 612, 19, 43, "Input"],
Cell[CellGroupData[{
Cell[11883, 394, 126, 2, 27, "Input"],
Cell[12012, 398, 443, 11, 27, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12492, 414, 376, 11, 27, "Input"],
Cell[12871, 427, 120, 1, 27, "Output"]
}, Open  ]],
Cell[13006, 431, 513, 16, 43, "Input"],
Cell[13522, 449, 505, 15, 27, "Input"],
Cell[14030, 466, 131, 4, 27, "Input"]
}
]
*)

(* End of internal cache information *)
