(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     14590,        399]
NotebookOptionsPosition[     13332,        361]
NotebookOutlinePosition[     13992,        383]
CellTagsIndexPosition[     13949,        380]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetDirectory", "[", "\"\<~/Math/ML-Fun\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.5478406849332952`*^9, 3.5478407140581713`*^9}, {
  3.547852106695486*^9, 3.547852107037733*^9}}],

Cell[BoxData[
 RowBox[{"<<", "ML`"}]], "Input",
 CellChangeTimes->{{3.547840667918001*^9, 3.547840670388102*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"getdata", "[", "filename_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "data", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"filename", ",", "String"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"data", ",", 
        RowBox[{"LengthWhile", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringLength", "[", "#", "]"}], "\[NotEqual]", "32"}], 
            ")"}], "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"data", ",", "33"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", "i", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"image", ",", "digit"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"image", "=", 
             RowBox[{"Take", "[", 
              RowBox[{"i", ",", "32"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"digit", "=", 
             RowBox[{
              RowBox[{"Last", "[", "i", "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"image", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Characters", "/@", "image"}], "//", "Flatten"}], "//", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#", "\[Equal]", "\"\<1\>\""}], ",", "1", ",", 
                    "0"}], "]"}], "&"}], ",", "#"}], "]"}], "&"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"digit", ",", "image"}], "}"}]}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "data"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.547758801054112*^9, 3.547758813168775*^9}, {
  3.547759139882358*^9, 3.547759181241293*^9}, {3.547759249416051*^9, 
  3.547759278350418*^9}, {3.547759537311398*^9, 3.547759538848544*^9}, {
  3.547759735079343*^9, 3.547759821234543*^9}, {3.547759897243471*^9, 
  3.547760282466511*^9}, {3.5477603131671333`*^9, 3.547760315880258*^9}, {
  3.547760564641898*^9, 3.547760585266046*^9}, {3.5477606969128428`*^9, 
  3.5477607047995377`*^9}, {3.547761403072321*^9, 3.547761407665997*^9}, {
  3.5477615306115723`*^9, 3.547761530963106*^9}, {3.5477615899167633`*^9, 
  3.547761592330594*^9}, {3.5477619390888443`*^9, 3.547761941205791*^9}, {
  3.5477650417281933`*^9, 3.547765046025988*^9}, {3.547765130301025*^9, 
  3.5477651314819117`*^9}, {3.54776530075187*^9, 3.547765306007084*^9}, {
  3.547833338347804*^9, 3.547833338835495*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"trainingdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.tra\>\"", "]"}]}]}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.54783333005844*^9, 3.547833347447959*^9}, {
  3.547833396270756*^9, 3.547833479753921*^9}, {3.5478335121098137`*^9, 
  3.547833542674899*^9}, {3.5478335749661083`*^9, 3.547833577452175*^9}, {
  3.54784077212469*^9, 3.547840772526857*^9}, {3.5478421631535387`*^9, 
  3.547842164703685*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"validationdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.cv\>\"", "]"}]}]}], "]"}]}],
   ";"}]], "Input",
 CellChangeTimes->{{3.547833748548414*^9, 3.5478337941448317`*^9}, {
  3.547840775571583*^9, 3.547840775796455*^9}, {3.5478421686560287`*^9, 
  3.5478421704152937`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Image", "[", 
     RowBox[{"Partition", "[", 
      RowBox[{"#", ",", "32"}], "]"}], "]"}], "&"}], "/@", 
   RowBox[{"GetVec", "/@", 
    RowBox[{"Take", "[", 
     RowBox[{"trainingdata", ",", "10"}], "]"}]}]}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.547766602195786*^9, 3.54776670115343*^9}, {
  3.547833605551785*^9, 3.547833627322822*^9}, {3.547842058790139*^9, 
  3.547842061984701*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Image", "[", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{"ClassMatrix", "[", 
         RowBox[{"trainingdata", ",", "c"}], "]"}], "]"}], ",", "32"}], "]"}],
      "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", "0", ",", "9"}], "}"}]}], "]"}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.547833634763041*^9, 3.5478337210375853`*^9}, {
  3.547842191270784*^9, 3.5478421931340017`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Image", "[", 
     RowBox[{"Partition", "[", 
      RowBox[{
       RowBox[{"Mean", "[", 
        RowBox[{"ClassMatrix", "[", 
         RowBox[{"validationdata", ",", "c"}], "]"}], "]"}], ",", "32"}], 
      "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", "0", ",", "9"}], "}"}]}], "]"}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{{3.547833809856688*^9, 3.547833816159973*^9}, {
  3.547842149497142*^9, 3.547842151958467*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"nozeros", ",", "zeromat"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"RemoveZeros", "[", "trainingdata", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input",
 CellChangeTimes->{{3.547838825875153*^9, 3.547838873295889*^9}, {
  3.54784207764389*^9, 3.5478420802404547`*^9}, {3.547842285548286*^9, 
  3.547842287497623*^9}, {3.547853047230473*^9, 3.547853051686676*^9}, {
  3.547853354334651*^9, 3.5478533588289223`*^9}, {3.5478538633344088`*^9, 
  3.547853863698592*^9}, {3.547854278806394*^9, 3.5478542803489943`*^9}, {
  3.547854443617148*^9, 3.5478544524146233`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"newdata", ",", "cmat", ",", "cfun", ",", "evals"}], "}"}]}], 
    "}"}], "=", 
   RowBox[{
    RowBox[{"MakeLDA", "[", "nozeros", "]"}], "//", "AbsoluteTiming"}]}], ";",
   "t"}]], "Input",
 CellChangeTimes->{{3.547833996836062*^9, 3.547834019618787*^9}, {
   3.547834079123604*^9, 3.547834080964219*^9}, {3.54783707854889*^9, 
   3.547837087478183*^9}, {3.5478388124374228`*^9, 3.547838820609147*^9}, {
   3.5478388888585033`*^9, 3.547838889726625*^9}, {3.547839144537993*^9, 
   3.547839145758144*^9}, {3.547842086467471*^9, 3.5478420901916323`*^9}, 
   3.547850632972143*^9, {3.54785224859485*^9, 3.547852249943948*^9}, {
   3.547852298025709*^9, 3.547852308367865*^9}, {3.5478523525136557`*^9, 
   3.547852368133498*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "normal"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MultiVariateNormalClassifier", "[", "newdata", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input",
 CellChangeTimes->{{3.5478441203697557`*^9, 3.547844136358136*^9}, {
   3.5478443008510647`*^9, 3.547844301656519*^9}, 3.547851708836231*^9, {
   3.547851992501717*^9, 3.547851995402804*^9}, {3.5478546927533693`*^9, 
   3.547854701719612*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"normguess", "[", "i_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "converted", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"converted", ":=", 
      RowBox[{"cfun", "[", 
       RowBox[{"zeromat", ".", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normal", "[", "converted", "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.5478447564816513`*^9, 3.547844814938398*^9}, {
  3.5478515170510674`*^9, 3.54785151838011*^9}, {3.547853467633008*^9, 
  3.5478534677767076`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "results"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MapVecs", "[", 
     RowBox[{"normguess", ",", "validationdata"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input",
 CellChangeTimes->{{3.547844822250861*^9, 3.547844837017276*^9}, {
  3.547845562690538*^9, 3.547845564427267*^9}, {3.547850653503159*^9, 
  3.547850670235992*^9}, {3.547852778817224*^9, 3.547852789046741*^9}}],

Cell[BoxData[
 RowBox[{"errorcount", "=", 
  RowBox[{"Apply", "[", 
   RowBox[{"Plus", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
      ")"}], "/@", "results"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.547844856881179*^9, 3.54784485905781*^9}, {
  3.5478506630921087`*^9, 3.547850687809742*^9}}],

Cell[BoxData[
 RowBox[{"errorproportion", "=", 
  RowBox[{"errorcount", "/", 
   RowBox[{"Length", "[", "results", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.547844873985156*^9, 3.5478448834252453`*^9}, {
  3.5478506796842012`*^9, 3.547850691473084*^9}}],

Cell[BoxData[
 RowBox[{"N", "[", "errorproportion", "]"}]], "Input",
 CellChangeTimes->{{3.5478451727641563`*^9, 3.5478451871497927`*^9}, 
   3.5478506948515368`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Range", "[", 
    RowBox[{"0", ",", "9"}], "]"}], "/.", 
   RowBox[{"GatherData", "[", "results", "]"}]}], "//", 
  "TableForm"}]], "Input",
 CellChangeTimes->{
  3.547845135240394*^9, {3.547850697089617*^9, 3.547850697159904*^9}, 
   3.547850776721789*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "res_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Reap", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"GetVec", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[Equal]", 
          RowBox[{"GetClass", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
         RowBox[{"Sow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"GetClass", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"GetVec", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{
               RowBox[{"GetVec", "[", 
                RowBox[{"validationdata", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "32"}], "]"}], "//",
              "Image"}]}], "}"}], "]"}]}], "]"}]}], ")"}], 
     "\[IndentingNewLine]", "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "res", "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.547845381350013*^9, 3.5478455108214703`*^9}, {
   3.547845583908944*^9, 3.547845679264914*^9}, 3.547845712635857*^9, {
   3.547845761926787*^9, 3.547845842357706*^9}, {3.547849368536566*^9, 
   3.5478493955109673`*^9}, {3.5478504236000633`*^9, 3.547850514618668*^9}, {
   3.54785058035892*^9, 3.547850580449267*^9}, {3.547851780380522*^9, 
   3.547851815169909*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "results", "]"}], "//", "TableForm"}]], "Input",
 CellChangeTimes->{{3.547845718346778*^9, 3.547845726028459*^9}, 
   3.547850702637817*^9}]
},
WindowSize->{851, 740},
WindowMargins->{{8, Automatic}, {Automatic, 0}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, \
2011)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]]}, WindowSize -> {740, 652}, 
  WindowMargins -> {{Automatic, 216}, {16, Automatic}}, Visible -> False, 
  FrontEndVersion -> 
  "8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, 2011)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 204, 3, 27, "Input"],
Cell[764, 25, 113, 2, 27, "Input"],
Cell[880, 29, 3076, 69, 193, "Input"],
Cell[3959, 100, 815, 20, 27, "Input"],
Cell[4777, 122, 672, 18, 27, "Input"],
Cell[5452, 142, 469, 13, 27, "Input"],
Cell[5924, 157, 525, 15, 27, "Input"],
Cell[6452, 174, 524, 15, 27, "Input"],
Cell[6979, 191, 692, 15, 27, "Input"],
Cell[7674, 208, 834, 18, 27, "Input"],
Cell[8511, 228, 476, 11, 27, "Input"],
Cell[8990, 241, 588, 13, 73, "Input"],
Cell[9581, 256, 463, 11, 27, "Input"],
Cell[10047, 269, 581, 16, 27, "Input"],
Cell[10631, 287, 254, 5, 27, "Input"],
Cell[10888, 294, 166, 3, 27, "Input"],
Cell[11057, 299, 304, 9, 27, "Input"],
Cell[11364, 310, 1768, 43, 88, "Input"],
Cell[13135, 355, 193, 4, 27, "Input"]
}
]
*)

(* End of internal cache information *)
