(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     16720,        519]
NotebookOptionsPosition[     14891,        466]
NotebookOutlinePosition[     15551,        488]
CellTagsIndexPosition[     15508,        485]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"SetDirectory", "[", "\"\<~/Math/ML-Fun\>\"", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"<<", "ML`"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getdata", "[", "filename_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "data", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"data", "=", 
      RowBox[{"ReadList", "[", 
       RowBox[{"filename", ",", "String"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Drop", "[", 
       RowBox[{"data", ",", 
        RowBox[{"LengthWhile", "[", 
         RowBox[{"data", ",", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringLength", "[", "#", "]"}], "\[NotEqual]", "32"}], 
            ")"}], "&"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"data", "=", 
      RowBox[{"Partition", "[", 
       RowBox[{"data", ",", "33"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", "i", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Module", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"image", ",", "digit"}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"image", "=", 
             RowBox[{"Take", "[", 
              RowBox[{"i", ",", "32"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"digit", "=", 
             RowBox[{
              RowBox[{"Last", "[", "i", "]"}], "//", "ToExpression"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"image", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Characters", "/@", "image"}], "//", "Flatten"}], "//", 
              RowBox[{
               RowBox[{"Map", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Boole", "[", 
                   RowBox[{"#", "\[Equal]", "\"\<1\>\""}], "]"}], "&"}], ",", 
                 "#"}], "]"}], "&"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"digit", "\[Equal]", "0"}], ",", "10", ",", "digit"}],
                "]"}], ",", "image"}], "}"}]}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "data"}], "]"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.547939810734888*^9, 3.547939834653511*^9}, {
  3.547940067765718*^9, 3.547940133924811*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"trainingdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.tra\>\"", "]"}]}]}], 
    "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"validationdata", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{"N", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"sample", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ")"}], "/@", 
      RowBox[{"getdata", "[", "\"\<optdigits-orig.cv\>\"", "]"}]}]}], "]"}]}],
   ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "[", "x_", "]"}], ":=", 
  RowBox[{"Image", "[", 
   RowBox[{"Partition", "[", 
    RowBox[{"x", ",", "32"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"toimage", "/@", 
   RowBox[{"GetVec", "/@", 
    RowBox[{"Take", "[", 
     RowBox[{"trainingdata", ",", "10"}], "]"}]}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"toimage", "[", 
     RowBox[{"Mean", "[", 
      RowBox[{"ClassMatrix", "[", 
       RowBox[{"trainingdata", ",", "c"}], "]"}], "]"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{"c", ",", "0", ",", "9"}], "}"}]}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fullmean", "=", 
   RowBox[{"Mean", "[", 
    RowBox[{"FullMatrix", "[", "trainingdata", "]"}], "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"datatranslated", "=", 
   RowBox[{"MapVecs", "[", 
    RowBox[{
     RowBox[{"x", "\[Function]", 
      RowBox[{"x", "-", "fullmean"}]}], ",", "trainingdata"}], "]"}]}], 
  ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"nozeros", ",", "zeromat"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"RemoveZeros", "[", "datatranslated", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", 
      RowBox[{"{", 
       RowBox[{"newdata", ",", "mat", ",", "evals"}], "}"}]}], "}"}], "=", 
    RowBox[{
     RowBox[{"MakeLDA", "[", "nozeros", "]"}], "//", "AbsoluteTiming"}]}], 
   ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", 
     RowBox[{"{", 
      RowBox[{"newdata", ",", "mat", ",", "vals"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"MakePCA", "[", 
     RowBox[{"nozeros", ",", "40"}], "]"}], "//", "AbsoluteTiming"}]}], ";", 
  "t"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "normal"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MultiVariateNormalClassifier", "[", "newdata", "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "normal"}], "}"}], "=", 
    RowBox[{
     RowBox[{
     "MultiVariateNormalClassifierSingleCovariance", "[", "newdata", "]"}], "//",
      "AbsoluteTiming"}]}], ";", "t"}], "*)"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cmat", "=", 
   RowBox[{"mat", ".", "zeromat"}]}], ";"}]], "Input",
 CellChangeTimes->{3.5479429454357977`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"normguess", "[", "i_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "converted", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"converted", ":=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"i", "-", "fullmean"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"normal", "[", "converted", "]"}]}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"t", ",", "results"}], "}"}], "=", 
   RowBox[{
    RowBox[{"MapVecs", "[", 
     RowBox[{"normguess", ",", "validationdata"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";", "t"}]], "Input"],

Cell[BoxData[
 RowBox[{"errorcount", "=", 
  RowBox[{"Apply", "[", 
   RowBox[{"Plus", ",", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"s", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
          RowBox[{"s", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
      ")"}], "/@", "results"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"Length", "[", "results", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"1.0", "-", 
  RowBox[{"N", "[", 
   RowBox[{"errorcount", "/", 
    RowBox[{"Length", "[", "results", "]"}]}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Range", "[", 
    RowBox[{"0", ",", "9"}], "]"}], "/.", 
   RowBox[{"GatherData", "[", "results", "]"}]}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "res_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Reap", "[", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"GetVec", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "\[Equal]", 
          RowBox[{"GetClass", "[", 
           RowBox[{"res", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
         RowBox[{"Sow", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"GetVec", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"GetClass", "[", 
             RowBox[{"res", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            RowBox[{"toimage", "[", 
             RowBox[{"GetVec", "[", 
              RowBox[{"validationdata", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], "}"}], "]"}]}],
         "]"}]}], ")"}], "\[IndentingNewLine]", "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "res", "]"}], "]"}]}], "]"}], "[", 
   RowBox[{"[", 
    RowBox[{"2", ",", "1"}], "]"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"showerrors", "[", "results", "]"}], "//", "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"mattransversed", "=", 
   SuperscriptBox["mat", "\[Transpose]"]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"unzeromat", "=", 
   RowBox[{"PseudoInverse", "[", "zeromat", "]"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"uncmat", "=", 
   RowBox[{"unzeromat", ".", "mattransversed"}]}], ";"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"eigenproject", "[", "x_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"vec", ",", "converted", ",", "restored"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vec", "=", 
      RowBox[{"GetVec", "[", "x", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"converted", "=", 
      RowBox[{"cmat", ".", 
       RowBox[{"(", 
        RowBox[{"vec", "-", "fullmean"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"restored", "=", 
      RowBox[{
       RowBox[{"uncmat", ".", "converted"}], "+", "fullmean"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"toimage", "[", "vec", "]"}], ",", 
       RowBox[{"toimage", "[", "restored", "]"}]}], "}"}]}]}], 
   "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{"eigenproject", "/@", 
  RowBox[{"Take", "[", 
   RowBox[{"trainingdata", ",", "32"}], "]"}]}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Partition", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"i", "\[Function]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"vals", "[", 
          RowBox[{"[", "i", "]"}], "]"}], ",", 
         RowBox[{"toimage", "[", 
          RowBox[{
           RowBox[{"unzeromat", ".", 
            RowBox[{"mat", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "+", "fullmean"}], "]"}]}], 
        "}"}]}], ")"}], "/@", 
     RowBox[{"Range", "[", 
      RowBox[{"Length", "[", "mat", "]"}], "]"}]}], ",", "8"}], "]"}], "//", 
  "TableForm"}]], "Input"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "decisiontree"}], "}"}], "=", 
    RowBox[{
     RowBox[{"MakeTree", "[", 
      RowBox[{
       RowBox[{"Take", "[", 
        RowBox[{"newdata", ",", "500"}], "]"}], ",", ".75"}], "]"}], "//", 
     "AbsoluteTiming"}]}], ";", "t"}], "*)"}]], "Input",
 CellChangeTimes->{{3.547927569664506*^9, 3.5479275830832863`*^9}, {
   3.5479276147382603`*^9, 3.547927659480291*^9}, 3.547936580707494*^9, {
   3.547936643680984*^9, 3.54793665139822*^9}, 3.547937485462233*^9, 
   3.547937656195476*^9, {3.54793774999831*^9, 3.54793775704539*^9}, {
   3.547937927152376*^9, 3.54793792903939*^9}, {3.5479384695125933`*^9, 
   3.547938472622919*^9}, {3.547942004599671*^9, 3.547942005406307*^9}, 
   3.547942631988744*^9, {3.547943086136278*^9, 3.547943117028489*^9}, {
   3.547943222451442*^9, 3.547943222586684*^9}, {3.547943264114307*^9, 
   3.547943264497106*^9}, 3.547943369563037*^9, {3.547943425231797*^9, 
   3.5479434270516987`*^9}, {3.547943500219316*^9, 3.5479435021606197`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", ",", "results2"}], "}"}], "=", 
    RowBox[{
     RowBox[{"MapVecs", "[", 
      RowBox[{
       RowBox[{"x", "\[Function]", 
        RowBox[{"TreeClassify", "[", 
         RowBox[{"decisiontree", ",", 
          RowBox[{"cmat", ".", 
           RowBox[{"(", 
            RowBox[{"x", "-", "fullmean"}], ")"}]}]}], "]"}]}], ",", 
       "validationdata"}], "]"}], "//", "AbsoluteTiming"}]}], ";", "t"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.547936145755105*^9, 3.547936235753582*^9}, {
   3.547936270137041*^9, 3.547936393870215*^9}, {3.547936530541641*^9, 
   3.54793656939415*^9}, {3.547936790258712*^9, 3.5479368021206408`*^9}, {
   3.547936955679874*^9, 3.547936975588345*^9}, 3.547937006116149*^9, 
   3.547937482574957*^9, 3.5479376580565023`*^9, {3.547937932777546*^9, 
   3.547937936830757*^9}, {3.547938432633533*^9, 3.547938435063271*^9}, {
   3.547943504275413*^9, 3.547943506928739*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"errorcount2", "=", 
   RowBox[{"Apply", "[", 
    RowBox[{"Plus", ",", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"s", "\[Function]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"s", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", 
           RowBox[{"s", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], ",", "0", ",", "1"}], "]"}]}], 
       ")"}], "/@", "results2"}]}], "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.5479377041126223`*^9, 3.547937706277767*^9}, {
  3.547937939128084*^9, 3.547937940671664*^9}, {3.547938760089951*^9, 
  3.54793876124736*^9}, {3.547943508769092*^9, 3.5479435104412107`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"showerrors", "[", "results2", "]"}], "//", "TableForm"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.547937724694476*^9, 3.54793772966098*^9}, {
  3.547937943056025*^9, 3.547937945358563*^9}, {3.5479387635464993`*^9, 
  3.547938764574443*^9}, {3.547943512624126*^9, 3.547943514408876*^9}}]
},
WindowSize->{851, 740},
WindowMargins->{{8, Automatic}, {Automatic, 0}},
FrontEndVersion->"8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, \
2011)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[StyleDefinitions -> "Default.nb"]]}, WindowSize -> {740, 652}, 
  WindowMargins -> {{Automatic, 216}, {16, Automatic}}, Visible -> False, 
  FrontEndVersion -> 
  "8.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (October 5, 2011)", 
  StyleDefinitions -> "PrivateStylesheetFormatting.nb"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 85, 1, 27, "Input"],
Cell[645, 23, 47, 1, 27, "Input"],
Cell[695, 26, 2429, 61, 193, "Input"],
Cell[3127, 89, 503, 15, 27, "Input"],
Cell[3633, 106, 502, 15, 27, "Input"],
Cell[4138, 123, 180, 5, 27, "Input"],
Cell[4321, 130, 192, 6, 27, "Input"],
Cell[4516, 138, 329, 10, 27, "Input"],
Cell[4848, 150, 156, 4, 27, "Input"],
Cell[5007, 156, 224, 7, 27, "Input"],
Cell[5234, 165, 282, 9, 27, "Input"],
Cell[5519, 176, 312, 10, 27, "Input"],
Cell[5834, 188, 305, 10, 27, "Input"],
Cell[6142, 200, 232, 7, 27, "Input"],
Cell[6377, 209, 285, 9, 27, "Input"],
Cell[6665, 220, 146, 4, 27, "Input"],
Cell[6814, 226, 444, 11, 73, "Input"],
Cell[7261, 239, 253, 8, 27, "Input"],
Cell[7517, 249, 465, 14, 27, "Input"],
Cell[7985, 265, 65, 1, 27, "Input"],
Cell[8053, 268, 153, 4, 27, "Input"],
Cell[8209, 274, 187, 6, 27, "Input"],
Cell[8399, 282, 1285, 34, 88, "Input"],
Cell[9687, 318, 101, 2, 27, "Input"],
Cell[9791, 322, 118, 3, 31, "Input"],
Cell[9912, 327, 122, 3, 27, "Input"],
Cell[10037, 332, 117, 3, 27, "Input"],
Cell[10157, 337, 849, 24, 103, "Input"],
Cell[11009, 363, 128, 3, 27, "Input"],
Cell[11140, 368, 612, 19, 43, "Input"],
Cell[11755, 389, 1069, 21, 27, "Input"],
Cell[12827, 412, 994, 23, 43, "Input"],
Cell[13824, 437, 718, 18, 27, "Input"],
Cell[14545, 457, 342, 7, 27, "Input"]
}
]
*)

(* End of internal cache information *)
